import { track } from "ripple"
import type { PropsWithChildren } from "ripple";
import { normalizeStyleObject } from "@ripple-primitives/utils" 

const NODES = [
  'a',
  'button',
  'div',
  'form',
  'h2',
  'h3',
  'img',
  'input',
  'label',
  'li',
  'nav',
  'ol',
  'p',
  'select',
  'span',
  'svg',
  'ul',
] as const;

type Primitives = { [E in (typeof NODES)[number]]: PrimitiveProps<E> };

type PrimitiveProps<T extends object = {}> = PropsWithChildren<{ asChild?: boolean }>

/*
    <Primitive.div />
    <Primitive.button />
*/
export const Primitive = NODES.reduce(
    (primitive, node) => {
        component Node({children, asChild, style, ...props} : PrimitiveProps){
            let tag = track(node);
            if(asChild) {
                <@children style={normalizeStyleObject(style)} {...@props} />
            }
            else {
                <@tag style={normalizeStyleObject(style)} {...@props}>
                    <@children />
                </@tag> 
            }
        }
        return {
            ...primitive, [node]: Node
        }
    }, {} as Primitives
)